name: ðŸš€ AI review code

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  main:
    name: ðŸ“¦ Build and Push Services
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout Context
        uses: actions/checkout@v4
      - name: Láº¥y pháº§n code thay Ä‘á»•i (diff)
        run: |
          git fetch origin
          git diff HEAD^ HEAD > diff.txt

          - name: Gá»i OpenAI Ä‘á»ƒ review code
            id: ai_review
            env:
              OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
            run: |
              PROMPT="Review Ä‘oáº¡n code sau vÃ  gÃ³p Ã½ cáº£i thiá»‡n:\n$(cat diff.txt)"
              
              RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
                -H "Authorization: Bearer $OPENAI_API_KEY" \
                -H "Content-Type: application/json" \
                -d '{
                  "model": "gpt-4",
                  "messages": [{"role": "user", "content": "'"${PROMPT}"'"}],
                  "temperature": 0.3
                }')
              
              echo "$RESPONSE" > response.json
              REVIEW=$(jq -r '.choices[0].message.content' response.json)
              echo "$REVIEW" > review.txt
              echo "review=$REVIEW" >> $GITHUB_OUTPUT
      - name: Gá»­i email vá»›i káº¿t quáº£ review
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          subject: "ðŸ§  AI Code Review - Push lÃªn main"
          to: your-email@example.com
          from: "AI Reviewer <your-email@example.com>"
          body_file: review.txt
      
